<!DOCTYPE html>
<html>
<head>
	<script src="tb.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<link rel="stylesheet" href="style.css"/>
</head>
<body>
	<h1>WebRTC</h1>
	<div class="fullscreen"><video></video></div>
<script>


var publisher = TB.initPublisher('video').on({
	started : function(){
		// Flip content horizontally, so for the publisher
		publisher.el.style.webkitTransform = "scaleX(-1)";

		console.log('The users media has been bound to the page');
	},
	failure : function(event){
		console.error( "Camera not available: " + (event&&event.code===1
			?'user denied'
			:'unknown'));
	}
});


var session  = TB.initSession();
session.on({
	sessionConnected : function(event){
		console.log('hurrah, connected to session');
		session.publish(publisher);
	},
	streamCreated : function(event){

		var video = newVideoTag();
		video.src = window.URL.createObjectURL(event.stream);
		video.autoplay = true;
		video.onerror = function(){
			alert('streamdestroyed');
		}
	},
	streamDestroyed : function(event){
		console.log('streamdestroyed');
	},
	message : function(event){
		console.log('message');
		console.log(event);
	},
	connectionDestroyed : function(){}
});

session.connect();



/**
 * Helper function to create clickable images of the video streams coming in.
 */
(function(){
	var i=0;

	window.newVideoTag = function (){

		var div = document.createElement('div');
		div.className = String.fromCharCode(i++ +97);
		div.addEventListener('click', function(){
			// swap classNames
			document.querySelector('.fullscreen').className = this.className;
			this.className = 'fullscreen';
		});

		var video = document.createElement('video');
		video.autoplay = true;
		div.appendChild(video);

		document.body.appendChild(div);

		return video;
	}
})();



</script>
</body>
</html>